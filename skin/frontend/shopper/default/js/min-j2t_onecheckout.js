var J2t_One_Checkout=Class.create();J2t_One_Checkout.prototype={initialize:function(a){this.saveMethodUrl=a.saveMethod;this.failureUrl=a.failure;this.method="";this.showOverlay=a.showOverlay;this.shippingUrl=a.shippingUrl;this.saveBilling=a.saveBilling;this.shippingMethod=a.shippingMethod;this.paymentMethod=a.paymentMethod;this.reviewUrl=a.reviewUrl;this.couponUrl=a.couponUrl;this.rewardUrl=null;this.j2tbillingUrl=a.j2tbillingUrl;this.doSubmitPayment=false;this.doRefreshReview=false;this.doSaveShipping=false;this.doSaveShippingMethod=false;this.doSavePaymentMethod=false;this.doSubmitOrder=false;this.submittingOrder=false;this.shippingQuoteMethodUrl=a.shippingQuoteMethodUrl;this.stepProcess=0;this.firstLoad=true;this.userLoggedAddress=false;this.stepShippingComplete=false;this.stepPaymentComplete=false;this.stepShippingChecked=false;this.needPaymentRefresh=true;this.checkRedirect=false;this.reloadShippingOnBilling=false;this.saveShippingOnBilling=true;this.reloadPaymentMethodOnShipping=false;this.reloadReviewOnShippingSave=false;this.saveRealShipping=false;this.stepSoColissimo=false;this.stepShippingMethodOk=false;this.stepPaymentMethodOk=false;this.stepOrderReviewOk=false;this.stepOrderCouponOk=false;this.stepOrderRewardOk=false;this.stepReloadShippingAtEnd=false;this.stepReloadShippingAtEndAction=false;this.billingCity="";this.billingPostCode="";this.billingRegion="";this.billingCountry="";this.billingSelect="";this.shippingCity="";this.shippingPostCode="";this.shippingRegion="";this.shippingCountry="";this.shippingSelect="";this.shippingQuotePostCode="";this.shippingQuoteRegion="";this.shippingQuoteCountry="";this.processBillingOperation=true;this.processShippingOperation=true;this.canHideFinishAddressTip=false;this.savePayment=false;this.goReview=false;this.paymentFormSerialize=null;this.paymentFormSerializeText=null},saveAndSubmitAll:function(){j2t_one_checkout.unrestrictForms();j2t_one_checkout.doSaveShipping=true;j2t_one_checkout.doSaveShippingMethod=true;j2t_one_checkout.doSavePaymentMethod=true;j2t_one_checkout.doSubmitOrder=true;j2t_one_checkout.goReview=true;billing.save()},checkOverlay:function(){if($("j2t-onecheckout-loading").getStyle("display")=="block"){$("j2t-onecheckout-address").hide();$("j2t-onecheckout-address-arraw").hide()}else{if($("j2t-onecheckout-address").getStyle("display")=="block"){$("j2t-onecheckout-loading").hide()}}},showAddressModifying:function(){if(j2t_one_checkout.showOverlay==1){$("j2t-onecheckout-address-complete").hide();var a=$("j2t-onecheckout-left-1").getWidth();var g=$("j2t-onecheckout-title").getHeight();var f=$("j2t-onecheckout-main").getWidth()-$("j2t-onecheckout-left-1").getWidth();var b=$("j2t-onecheckout-main").getHeight();var e={position:"absolute",top:g+"px",left:a+"px",width:f+"px",height:b+"px"};var d={paddingTop:Math.round(b/2)+"px"};$("j2t-onecheckout-address").setStyle(e);$("j2t-onecheckout-address-txt").setStyle(d);if($("j2t-onecheckout-address").getStyle("display")!="block"){var c={position:"absolute",top:Math.round(b/2)+"px",left:(a-10)+"px"};$("j2t-onecheckout-address-arraw").setStyle(c);$("j2t-onecheckout-address-arraw").show();new Effect.Appear($("j2t-onecheckout-address"),{duration:0.5,to:0.9})}}},hideAddressModifying:function(){var a=true;if(j2t_one_checkout.reloadShippingOnBilling&&j2t_one_checkout.saveShippingOnBilling){var c=new Validation(shipping.form,{stopOnFirst:true,focusOnError:false});if(!c.validate()){c.reset();a=false}}if(a){var b=new Validation(billing.form,{stopOnFirst:true,focusOnError:false});if(!b.validate()){b.reset()}else{$("j2t-onecheckout-address").hide();$("j2t-onecheckout-address-arraw").hide()}}else{$("j2t-onecheckout-address-complete").show()}},restrictForms:function(){var e=($$("body")[0]).insert({bottom:new Element("div",{id:"j2t-overlay-unclick"})});var a=0;var f=0;var d=($$("body")[0]).getWidth();var b=($$("body")[0]).getHeight();var c={position:"absolute",top:f+"px",left:a+"px",width:d+"px",height:b+"px",background:"transparent",zIndex:10000};$("j2t-overlay-unclick").setStyle(c);$$("#discount-coupon-form .buttons-set").invoke("hide")},unrestrictForms:function(){if($("j2t-overlay-unclick")){$("j2t-overlay-unclick").remove()}$$("#co-shipping-method-form input").invoke("enable");$$("#co-shipping-method-form radio").invoke("enable");$$("#co-shipping-method-form select").invoke("enable");$$("#co-payment-form input").invoke("enable");$$("#co-payment-form radio").invoke("enable");$$("#co-payment-form select").invoke("enable");$$("#discount-coupon-form input").invoke("enable");$$("#discount-coupon-form select").invoke("enable");$$("#j2t-onecheckout-left-1 select").invoke("enable");$$("#j2t-onecheckout-left-1 input:radio").invoke("enable");$$("#discount-coupon-form .buttons-set").invoke("show")},showLoading:function(){$("j2t-shipping-please-wait").show();$("j2t-payment-please-wait").show();if(!j2t_one_checkout.submittingOrder){$("j2t-review-please-wait").show()}if(j2t_one_checkout.showOverlay!=1){$("j2t-onecheckout-address").hide();$("j2t-onecheckout-address-arraw").hide();this.restrictForms()}else{$("j2t-onecheckout-address").hide();$("j2t-onecheckout-address-arraw").hide();var a=0;var f=$("j2t-onecheckout-title").getHeight();var e=$("j2t-onecheckout-main").getWidth();var b=$("j2t-onecheckout-main").getHeight();var d={position:"absolute",top:f+"px",left:a+"px",width:e+"px",height:b+"px"};var c={paddingTop:Math.round(b/2)+"px"};$("j2t-onecheckout-loading").setStyle(d);$("j2t-onecheckout-loading-img").setStyle(c);new Effect.Appear($("j2t-onecheckout-loading"),{duration:0.5,to:0.9})}j2t_one_checkout.completeOff()},hideLoading:function(){if(j2t_one_checkout.stepShippingMethodOk&&j2t_one_checkout.stepPaymentMethodOk&&j2t_one_checkout.stepOrderReviewOk){$("j2t-shipping-please-wait").hide();$("j2t-payment-please-wait").hide();if(!j2t_one_checkout.submittingOrder){$("j2t-review-please-wait").hide()}if(j2t_one_checkout.showOverlay!=1){this.unrestrictForms();$("j2t-onecheckout-address").hide();$("j2t-onecheckout-address-arraw").hide()}else{if(this.canHideFinishAddressTip){$("j2t-onecheckout-address").hide();$("j2t-onecheckout-address-arraw").hide()}$("j2t-onecheckout-loading").hide()}j2t_one_checkout.stepShippingMethodOk=false;j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.stepOrderReviewOk=false;j2t_one_checkout.completeOn()}},resetBillingShipping:function(){this.processBillingOperation=true;this.processShippingOperation=true;this.billingCity="";this.billingPostCode="";this.billingRegion="";this.billingCountry="";this.billingSelect="";this.shippingCity="";this.shippingPostCode="";this.shippingRegion="";this.shippingCountry="";this.shippingSelect=""},checkBilling:function(){var b=true;var a=true;if($("billing-address-select")){if(this.billingSelect!=$F("billing-address-select")){b=false;a=false;this.billingSelect=$F("billing-address-select")}}if($("billing:city")&&a){if(this.billingCity!=$F("billing:city")){b=false;this.billingCity=$F("billing:city")}}if($("billing:postcode")&&a){if(this.billingPostCode!=$F("billing:postcode")){b=false;this.billingPostCode=$F("billing:postcode")}}if($("billing:region_id")&&a){if(this.billingRegion!=$F("billing:region_id")){b=false;this.billingRegion=$F("billing:region_id")}}if($("billing:country_id")&&a){if(this.billingCountry!=$F("billing:country_id")){b=false;this.billingCountry=$F("billing:country_id")}}if(!b){this.processBillingOperation=true}else{this.processBillingOperation=false}},submitShippingQuote:function(){if($("billing:use_for_shipping_yes").checked){shippingQuoteCountryTxt=$F("billing:country_id");shippingQuotePostCodeTxt=$F("billing:postcode");if($("billing:region_id")){shippingQuoteRegionTxt=$F("billing:region_id")}}else{shippingQuoteCountryTxt=$F("shipping:country_id");shippingQuotePostCodeTxt=$F("shipping:postcode");if($("shipping:region_id")){shippingQuoteRegionTxt=$F("shipping:region_id")}}if(this.shippingQuoteCountry!=shippingQuoteCountryTxt){j2t_one_checkout.showLoading();var a=new Ajax.Request(this.shippingQuoteMethodUrl,{asynchronous:true,method:"post",onFailure:function(c,b){alert("Exception : "+b)},onComplete:function(b){j2t_one_checkout.refreshShippingMethodRadio();j2t_one_checkout.refreshPaymentMethodInputs();j2t_one_checkout.reloadReview()},parameters:"country_id="+shippingQuoteCountryTxt+"&region_id="+shippingQuoteRegionTxt+"&estimate_postcode="+shippingQuotePostCodeTxt})}},checkShipping:function(){var b=true;var a=true;if($("shipping-address-select")){if(this.shippingSelect!=$F("shipping-address-select")){b=false;a=false;this.shippingSelect=$F("shipping-address-select")}}if($("shipping:city")&&a){if(this.shippingCity!=$F("shipping:city")){b=false;this.shippingCity=$F("shipping:city")}}if($("shipping:postcode")&&a){if(this.shippingPostCode!=$F("shipping:postcode")){b=false;this.shippingPostCode=$F("shipping:postcode")}}if($("shipping:region_id")&&a){if(this.shippingRegion!=$F("shipping:region_id")){b=false;this.shippingRegion=$F("shipping:region_id")}}if($("shipping:country_id")&&a){if(this.shippingCountry!=$F("shipping:country_id")){b=false;this.shippingCountry=$F("shipping:country_id")}}if($("billing:use_for_shipping_yes").checked){shippingQuoteCountryTxt=$F("billing:country_id");shippingQuotePostCodeTxt=$F("billing:postcode");if($("billing:region_id")){shippingQuoteRegionTxt=$F("billing:region_id")}}else{shippingQuoteCountryTxt=$F("shipping:country_id");shippingQuotePostCodeTxt=$F("shipping:postcode");if($("shipping:region_id")){shippingQuoteRegionTxt=$F("shipping:region_id")}}if(this.shippingQuoteCountry==shippingQuoteCountryTxt){b=false}if(!b){this.processShippingOperation=true}else{this.processShippingOperation=false}},ajaxFailure:function(){location.href=this.failureUrl},completeOn:function(){if($("review-buttons-container")&&!j2t_one_checkout.submittingOrder){$("review-buttons-container").show();$("order-info-complete").hide()}},completeOff:function(){if($("review-buttons-container")&&!j2t_one_checkout.submittingOrder){$("review-buttons-container").hide();$("order-info-complete").show()}},setMethodCheckbox:function(){if($("login:guest_register")&&$("login:guest_register").checked){if($("login:guest")){$("login:guest").checked=false}if($("login:register")){$("login:register").checked=true}}else{if($("login:register")){$("login:register").checked=false}if($("login:guest")){$("login:guest").checked=true}}this.setMethod()},setMethod:function(){if($("login:guest")&&$("login:guest").checked){this.method="guest";var a=new Ajax.Request(this.saveMethodUrl,{asynchronous:true,method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"guest"}});Element.hide("register-customer-password")}else{if($("login:register")&&($("login:register").checked||$("login:register").type=="hidden")){this.method="register";var a=new Ajax.Request(this.saveMethodUrl,{asynchronous:true,method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"register"}});Element.show("register-customer-password")}else{}}document.body.fire("login:setMethod",{method:this.method})},setLoadWaiting:function(a,b){if(a){Element.show(a+"-please-wait")}else{}},processShippingDetails:function(){if($("billing:use_for_shipping_yes").checked){j2t_one_checkout.showLoading();var a=$F("billing-address-select");if(a!=""){j2t_one_checkout.userLoggedAddress=true;billing.save()}else{j2t_one_checkout.userLoggedAddress=true;billing.save()}}else{j2t_one_checkout.showLoading();var b=$F("shipping-address-select");if(b!=""){j2t_one_checkout.userLoggedAddress=true;shipping.save()}else{j2t_one_checkout.userLoggedAddress=true;shipping.save()}}},processShippingSelection:function(){var d="";var a="";var i="";var c="";var f="";if($("billing:use_for_shipping_yes")){if(!$("billing:use_for_shipping_yes").checked){var g=$F("billing:country_id");var h=$F("billing:postcode");var b="";if($("billing:region_id")){b=$F("billing:region_id")}f="&billing_country_id="+g+"&billing_region_id="+b+"&billing_postcode="+h}}if(!$("billing:use_for_shipping_no")&&!$("billing:use_for_shipping_yes")){d=$F("billing:country_id");a=$F("billing:postcode");if($("billing:region_id")){i=$F("billing:region_id")}if($("billing-address-select")){if($F("billing-address-select")!=""){c="address_id="+$F("billing-address-select")}}}else{if($("billing:use_for_shipping_yes").checked){d=$F("billing:country_id");a=$F("billing:postcode");if($("billing:region_id")){i=$F("billing:region_id")}if($("billing-address-select")){if($F("billing-address-select")!=""){c="address_id="+$F("billing-address-select")}}}else{d=$F("shipping:country_id");a=$F("shipping:postcode");if($("shipping:region_id")){i=$F("shipping:region_id")}if($("billing-address-select")){if($F("shipping-address-select")!=""){c="address_id="+$F("shipping-address-select")}}}}if(c==""){c="country_id="+d+"&region_id="+i+"&postcode="+a}if($("billing:use_for_shipping_yes")){if($("billing:use_for_shipping_yes").checked){used_billing="&use_for_shipping=1"}else{used_billing="&use_for_shipping=0"}c=c+used_billing}if(f!=""){c=c+f}if(d!=""){j2t_one_checkout.showLoading();var e=new Ajax.Request(this.j2tbillingUrl,{asynchronous:true,method:"post",onSuccess:function(){j2t_one_checkout.stepReloadShippingAtEnd=false;j2t_one_checkout.reloadShippingSaveReloadReview()},parameters:c})}},processOrderSubmission:function(){j2t_one_checkout.showLoading();var a=new Ajax.Request(this.j2tbillingUrl,{asynchronous:true,method:"post",onSuccess:function(){billing.save()},parameters:"reset=1"})},processRegisterGuest:function(){if($("billing-address-select")||$("shipping-address-select")){if($("billing:use_for_shipping_yes").checked){if($F("billing:country_id")!=""){this.reloadShippingOnBilling=false;this.saveShippingOnBilling=false;billing.checkSave()}billing.checkSave()}else{if($F("shipping:country_id")!=""){this.reloadShippingOnBilling=true;this.saveShippingOnBilling=true;this.needPaymentRefresh=true;billing.checkSave()}}}else{var a="";var b="";var d="";if($("billing:use_for_shipping_yes").checked){a=$F("billing:country_id");b=$F("billing:postcode");if($("billing:region_id")){d=$F("billing:region_id")}}else{a=$F("shipping:country_id");b=$F("shipping:postcode");if($("shipping:region_id")){d=$F("shipping:region_id")}}if(a!=""){j2t_one_checkout.showLoading();var c=new Ajax.Request(this.j2tbillingUrl,{asynchronous:true,method:"post",onSuccess:function(){j2t_one_checkout.refreshShippingMethodRadio();j2t_one_checkout.refreshPaymentMethodInputs();j2t_one_checkout.reloadReview()},parameters:"country_id="+a+"&region_id="+d+"&postcode="+b})}}},restrictRewardButtons:function(){$$("#rewardFormArea button").each(function(b,a){$(b).stopObserving();$(b).writeAttribute("onclick",null);$(b).observe("click",function(c){if(!$("j2t-review-please-wait").visible()){$("j2t-review-please-wait").show();j2t_one_checkout.processRewardEntry()}})})},reloadRewardHtml:function(){if($("rewardFormArea")){j2t_one_checkout.stepOrderRewardOk=false;var a=this.rewardUrl;if($("j2t-review-please-wait")){$("j2t-review-please-wait").show();new Ajax.Request(a,{asynchronous:true,method:"get",on403:function(b){alert("Your session appears to have expired.  You will asked to log in again and returned here.");return true},onComplete:function(c){var b=c.responseText;b=b.replace("function verifyJ2tCartPointsValue","window.verifyJ2tCartPointsValue = function");$("rewardFormArea").replace(b);j2t_one_checkout.restrictRewardButtons();$("j2t-review-please-wait").hide();j2t_one_checkout.stepOrderRewardOk=true;j2t_one_checkout.hideLoading();j2t_one_checkout.refreshShippingMethodRadio()}})}}},processRewardEntry:function(){var d=$("discountFormPoints2");var a=d.action;var b=document.location.href;if(a.indexOf("http:")!=-1&&b.indexOf("https:")!=-1){a=a.replace("http:","https:")}else{if(a.indexOf("https:")!=-1&&b.indexOf("http:")!=-1){a=a.replace("https:","http:")}}var c=new Ajax.Request(a,{asynchronous:true,method:"post",onFailure:function(g,f){alert("Exception : "+f)},onSuccess:function(e){j2t_one_checkout.needPaymentRefresh=false;j2t_one_checkout.reloadReviewReward()},parameters:Form.serialize("discountFormPoints2")})},reloadReviewReward:function(){var a=this.reviewUrl;var b=this;if($("j2t-review-please-wait")){$("j2t-review-please-wait").show();new Ajax.Request(a,{asynchronous:true,method:"get",on403:function(c){alert("Your session appears to have expired.  You will asked to log in again and returned here.");return true},onComplete:function(c){if(c.responseText=="NO-ITEMS"){window.location.reload()}else{$$("#checkout-review-load .messages").each(Element.remove);$("checkout-review-table-wrapper").replace(c.responseText);$("j2t-review-please-wait").hide();j2t_one_checkout.hideLoading();b.reloadRewardHtml()}}})}},reloadCouponHtml:function(){j2t_one_checkout.stepOrderCouponOk=false;var a=this.couponUrl;if($("j2t-review-please-wait")){$("j2t-review-please-wait").show();new Ajax.Request(a,{asynchronous:true,method:"get",on403:function(b){alert("Your session appears to have expired.  You will asked to log in again and returned here.");return true},onComplete:function(b){$("checkout-review-coupon").innerHTML=b.responseText;$("j2t-review-please-wait").hide();j2t_one_checkout.stepOrderCouponOk=true;j2t_one_checkout.hideLoading();j2t_one_checkout.refreshShippingMethodRadio();j2t_one_checkout.restrictRewardButtons()}})}},processCouponEntry:function(){var d=$("discount-coupon-form");var a=(d.action).replace("/checkout/cart/couponPost","/j2tonecheckout/cart/couponPost");var b=document.location.href;if(a.indexOf("http:")!=-1&&b.indexOf("https:")!=-1){a=a.replace("http:","https:")}else{if(a.indexOf("https:")!=-1&&b.indexOf("http:")!=-1){a=a.replace("https:","http:")}}var c=new Ajax.Request(a,{asynchronous:true,method:"post",onFailure:function(g,f){alert("Exception : "+f)},onSuccess:function(e){$("j2t-coupon-ajax-reply").innerHTML=e.responseText;j2t_one_checkout.needPaymentRefresh=false;j2t_one_checkout.reloadReviewCoupon();$("j2t-coupon-ajax-reply").innerHTML=""},parameters:Form.serialize("discount-coupon-form")})},processCouponForm:function(){var b=$("discount-coupon-form");var a=$$(".checkout-onepage-index");if(b&&a.length>0){if(discountForm){discountForm.submit=function(c){if(c){$("coupon_code").removeClassName("required-entry");$("remove-coupone").value="1"}else{$("coupon_code").addClassName("required-entry");$("remove-coupone").value="0"}$("j2t-review-please-wait").show();j2t_one_checkout.processCouponEntry();return false}}}},reloadReviewCoupon:function(){var a=this.reviewUrl;var b=this;if($("j2t-review-please-wait")){$("j2t-review-please-wait").show();new Ajax.Request(a,{asynchronous:true,method:"get",on403:function(c){alert("Your session appears to have expired.  You will asked to log in again and returned here.");return true},onComplete:function(c){if(c.responseText=="NO-ITEMS"){window.location.reload()}else{$$("#checkout-review-load .messages").each(Element.remove);$("checkout-review-table-wrapper").replace(c.responseText);$("j2t-review-please-wait").hide();j2t_one_checkout.hideLoading();b.reloadCouponHtml();j2t_one_checkout.restrictRewardButtons()}}})}},reloadReview:function(){j2t_one_checkout.stepOrderReviewOk=false;if(j2t_one_checkout.stepReloadShippingAtEnd==true){j2t_one_checkout.stepReloadShippingAtEndAction=true;j2t_one_checkout.refreshShippingMethodRadio()}else{var a=this.reviewUrl;new Ajax.Request(a,{asynchronous:true,method:"get",on403:function(b){alert("Your session appears to have expired.  You will asked to log in again and returned here.");return true},onComplete:function(b){if(b.responseText=="NO-ITEMS"){window.location.reload()}else{$("checkout-review-table-wrapper").replace(b.responseText);$("j2t-review-please-wait").hide();j2t_one_checkout.completeOn();j2t_one_checkout.stepOrderReviewOk=true;j2t_one_checkout.hideLoading();if(j2t_one_checkout.goReview){j2t_one_checkout.goReview=false;review.saveGoReview()}}}})}},cartUpdateQty:function(){this.showLoading();var a=this;var b=$("co-update-cart-qty");var c=b.action;new Ajax.Request(c,{asynchronous:true,method:"post",postBody:b.serialize(),parameters:Form.serialize(b.name),onException:function(f,d){alert("Exception : "+d)},onComplete:function(d){a.stepShippingMethodOk=true;a.stepPaymentMethodOk=true;a.stepOrderReviewOk=true;a.reloadRewardHtml();a.reloadReviewCoupon()}})},deleteCartItem:function(b){this.showLoading();var a=this;new Ajax.Request(b,{asynchronous:true,method:"get",onException:function(d,c){alert("Exception : "+c)},onComplete:function(c){if(c.responseText=="NO-ITEMS"){window.location.reload()}else{$$("#checkout-review-load .messages").each(Element.remove);$("checkout-review-table-wrapper").replace(c.responseText);a.stepShippingMethodOk=true;a.stepPaymentMethodOk=true;a.stepOrderReviewOk=true;a.reloadRewardHtml();a.reloadCouponHtml()}}})},reloadPayment:function(){var a=this.paymentMethod;this.stepProcess=0;if($("j2t-payment-please-wait")){new Ajax.Request(a,{asynchronous:true,method:"get",onComplete:function(e){j2t_one_checkout.stepPaymentComplete=false;$("checkout-payment-method-load").replace(e.responseText);var d=false;var c=$("co-payment-form");var b=c.getInputs("radio");b.each(function(g,f){if(g.checked){d=true}});j2t_one_checkout.stepProcess++;payment.checkSave()}})}},backupPaymentMethodInputs:function(){j2t_one_checkout.paymentFormSerializeText=$("co-payment-form").serialize();j2t_one_checkout.paymentFormSerialize=$("co-payment-form").serialize(true)},restorePaymentMethodInputs:function(){var a=$("co-payment-form").select('input[type="radio"]');var c=$("co-payment-form").select('input[type="text"]');var b=$("co-payment-form").select("select");a.each(function(e,d){if(j2t_one_checkout.paymentFormSerialize!=undefined){if(j2t_one_checkout.paymentFormSerialize!=null){if(j2t_one_checkout.paymentFormSerialize[e.name]!=undefined){selected_payment_means=j2t_one_checkout.paymentFormSerialize[e.name];if(j2t_one_checkout.paymentFormSerialize[e.name] instanceof Array){if(j2t_one_checkout.paymentFormSerialize[e.name][1]!=undefined){if(j2t_one_checkout.paymentFormSerialize[e.name][1]==e.value){e.selected=true}}}else{if(j2t_one_checkout.paymentFormSerialize[e.name]==e.value){e.checked=true}}}}}});b.each(function(e,d){if(j2t_one_checkout.paymentFormSerialize!=undefined){if(j2t_one_checkout.paymentFormSerialize!=null){if(j2t_one_checkout.paymentFormSerialize[e.name]!=undefined){var f=e.select("option");f.each(function(h,g){if(j2t_one_checkout.paymentFormSerialize[e.name] instanceof Array){if(j2t_one_checkout.paymentFormSerialize[e.name][1]!=undefined){if(j2t_one_checkout.paymentFormSerialize[e.name][1]==h.value){h.selected=true}}}else{if(j2t_one_checkout.paymentFormSerialize[e.name]==h.value){h.selected=true}}})}}}});c.each(function(e,d){if(j2t_one_checkout.paymentFormSerialize!=undefined){if(j2t_one_checkout.paymentFormSerialize!=null){if(j2t_one_checkout.paymentFormSerialize[e.name]!=undefined){if(j2t_one_checkout.paymentFormSerialize[e.name] instanceof Array){if(j2t_one_checkout.paymentFormSerialize[e.name][1]!=undefined){e.value=j2t_one_checkout.paymentFormSerialize[e.name][1]}}else{e.value=j2t_one_checkout.paymentFormSerialize[e.name]}}}}})},refreshPaymentMethodInputs:function(){j2t_one_checkout.backupPaymentMethodInputs();j2t_one_checkout.stepPaymentMethodOk=false;var a=this.paymentMethod;if($("j2t-payment-please-wait")){new Ajax.Request(a,{asynchronous:true,method:"get",onComplete:function(g){$("checkout-payment-method-load").replace(g.responseText);j2t_one_checkout.stepPaymentMethodOk=true;$$("#co-payment-form input").invoke("enable");$$("#co-payment-form radio").invoke("enable");$$("#co-payment-form select").invoke("enable");var f=false;var e=$("co-payment-form");var b=e.getInputs("radio");var d=e.getInputs("text","password");var c=$("co-payment-form").select("select");b.each(function(i,h){i.stopObserving();i.observe("click",function(j){j2t_one_checkout.paymentFormSerializeText=$("co-payment-form").serialize();j2t_one_checkout.paymentFormSerialize=$("co-payment-form").serialize(true)})});c.each(function(i,h){i.stopObserving();i.observe("change",function(j){j2t_one_checkout.paymentFormSerializeText=$("co-payment-form").serialize();j2t_one_checkout.paymentFormSerialize=$("co-payment-form").serialize(true)})});d.each(function(i,h){i.stopObserving();i.observe("keyup",function(j){j2t_one_checkout.paymentFormSerializeText=$("co-payment-form").serialize();j2t_one_checkout.paymentFormSerialize=$("co-payment-form").serialize(true)})});b.each(function(i,h){i.observe("click",function(j){payment.saveNocheck()});if(i.checked){f=true}});j2t_one_checkout.restorePaymentMethodInputs();if(!f&&b.length>0){b[0].checked=true}if(j2t_one_checkout.doSubmitPayment){payment.saveNocheck();j2t_one_checkout.doSubmitPayment=false}j2t_one_checkout.hideLoading();if($$(".cvv-what-is-this").length>0){$$(".cvv-what-is-this").each(function(h){Event.observe(h,"click",function(i){toggleToolTip(i);$("payment-tool-tip").style.right="0px"})})}}})}},refreshPaymentSave:function(){j2t_one_checkout.doSubmitPayment=true;j2t_one_checkout.doRefreshReview=true;j2t_one_checkout.refreshPaymentMethodInputs()},reloadReviewFromSubmitShipping:function(){var a=new Ajax.Request(shippingMethod.saveUrl,{asynchronous:true,method:"post",onSuccess:function(){j2t_one_checkout.refreshPaymentSave()},parameters:Form.serialize(shippingMethod.form)})},reloadReviewFromSubmitOnlyShipping:function(){var a=new Ajax.Request(shippingMethod.saveUrl,{asynchronous:true,method:"post",parameters:Form.serialize(shippingMethod.form),onSuccess:function(){j2t_one_checkout.reloadReview()}})},clickSaveShipping:function(){j2t_one_checkout.reloadReviewOnShippingSave=true;if(j2t_one_checkout.saveRealShipping){j2t_one_checkout.showLoading();j2t_one_checkout.doSaveShipping=true;billing.save()}else{shippingMethod.save()}},reloadShippingSaveReloadReview:function(){j2t_one_checkout.stepShippingMethodOk=false;if(j2t_one_checkout.stepReloadShippingAtEnd==true){j2t_one_checkout.refreshPaymentSave()}else{var a=this.shippingUrl;new Ajax.Request(a,{asynchronous:true,method:"get",onComplete:function(e){$("checkout-shipping-method-load").innerHTML=e.responseText;j2t_one_checkout.stepShippingMethodOk=true;j2t_one_checkout.hideLoading();var c=$("co-shipping-method-form");var d=c.getInputs("radio");d.each(function(g,f){g.stopObserving();g.observe("click",function(h){j2t_one_checkout.stepShippingMethodOk=false;j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.stepOrderReviewOk=false;j2t_one_checkout.clickSaveShipping()})});var b=false;d.each(function(g,f){if(g.checked){b=true}});if(!b&&d.length>0){d[0].checked=true}if(typeof j2t_onecheckout_reload!=="undefined"){j2t_onecheckout_reload()}j2t_one_checkout.reloadReviewFromSubmitShipping()}})}},refreshShippingMethodRadio:function(){j2t_one_checkout.stepShippingMethodOk=false;var shippingUrl=this.shippingUrl;if($("j2t-shipping-please-wait")){new Ajax.Request(shippingUrl,{asynchronous:true,method:"get",onComplete:function(transport){$("checkout-shipping-method-load").innerHTML=transport.responseText;j2t_one_checkout.stepShippingMethodOk=true;j2t_one_checkout.hideLoading();var j2t_onechekout_shipment_form=$("co-shipping-method-form");var j2t_onechekout_shipment_radios=j2t_onechekout_shipment_form.getInputs("radio");var process_submit=true;j2t_onechekout_shipment_radios.each(function(el,index){el.stopObserving();var process_autosubmit=true;if(j2t_address_completion==1){el.autocheck=false;process_submit=false}el.observe("click",function(event){if(j2t_address_completion==1){if(billing.validateSilent()){el.checked=true;process_submit=true}else{el.checked=false;process_submit=false}}if(process_submit){if(el.value.indexOf("kiala")!=-1){if($$(".kialapoint-select").length>0){var kialapoint=$$(".kialapoint-select");var first_kiala=kialapoint[0];eval(first_kiala.getAttribute("onclick"))}else{j2t_one_checkout.saveRealShipping=false;if(j2t_address_completion==1){j2t_one_checkout.saveRealShipping=true}j2t_one_checkout.stepSoColissimo=false;j2t_one_checkout.stepShippingMethodOk=false;j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.stepOrderReviewOk=false;j2t_one_checkout.clickSaveShipping()}}else{if(el.value==rateCodeSoColissimoSimplicite&&el.checked){j2t_one_checkout.saveRealShipping=true;j2t_one_checkout.stepSoColissimo=true;j2t_one_checkout.stepShippingMethodOk=false;j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.stepOrderReviewOk=false;j2t_one_checkout.clickSaveShipping()}else{j2t_one_checkout.saveRealShipping=false;if(j2t_address_completion==1){j2t_one_checkout.saveRealShipping=true}j2t_one_checkout.stepSoColissimo=false;j2t_one_checkout.stepShippingMethodOk=false;j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.stepOrderReviewOk=false;j2t_one_checkout.clickSaveShipping()}}}})});var j2t_onechekout_checked=false;var is_socolissimo=false;j2t_onechekout_shipment_radios.each(function(elmt,index){if(elmt.checked){j2t_onechekout_checked=true;if(elmt.value==rateCodeSoColissimoSimplicite&&elmt.checked){$$(".so-colissimo").invoke("show")}}});if(j2t_address_completion!=1&&!j2t_onechekout_checked&&j2t_onechekout_shipment_radios.length>0){j2t_onechekout_shipment_radios[0].checked=true}if(j2t_one_checkout.stepReloadShippingAtEnd==true&&j2t_one_checkout.stepReloadShippingAtEndAction==true){j2t_one_checkout.stepReloadShippingAtEnd=false;j2t_one_checkout.stepReloadShippingAtEndAction=false;j2t_one_checkout.reloadReviewFromSubmitOnlyShipping()}if(typeof j2t_onecheckout_reload!=="undefined"){j2t_onecheckout_reload()}}})}},shippingMethodSave:function(){var b=$("co-shipping-method-form");var c=b.getInputs("radio");var a=false;c.each(function(e,d){if(e.checked){a=true}});if(j2t_address_completion!=1&&!a&&c.length>0){c[0].checked=true}setTimeout(function(){shippingMethod.saveRefresh()},200)},reloadAll:function(){this.reloadShippingMethod();this.reloadPayment();this.reloadReview();this.reloadReviewCoupon()},reloadShippingMethod:function(){new Ajax.Request(this.shippingMethod,{asynchronous:true,method:"get",onComplete:function(a){$("co-shipping-method-form").innerHTML=a.responseText},onSuccess:this.shippingMethodSave.bind(this)})},shippingSave:function(){setTimeout(function(){shippingMethod.save()},200)},reloadShippingSave:function(){var a=this.shippingUrl;new Ajax.Request(a,{asynchronous:true,method:"get",onSuccess:function(f){j2t_one_checkout.stepShippingComplete=false;$("checkout-shipping-method-load").innerHTML=f.responseText;var d=$("co-shipping-method-form");var e=d.getInputs("radio");var b=false;e.each(function(h,g){if(h.checked){b=true}});if(j2t_address_completion!=1&&!b&&e.length>0){var c=false;e.each(function(h,g){if(!c){h.checked=true;c=true}})}if(typeof j2t_onecheckout_reload!=="undefined"){j2t_onecheckout_reload()}},onComplete:this.shippingSave.bind(this)})},reloadShipping:function(){var a=this.shippingUrl;if($("j2t-shipping-please-wait")){new Ajax.Request(a,{asynchronous:true,method:"get",onComplete:function(e){j2t_one_checkout.stepShippingComplete=false;$("checkout-shipping-method-load").innerHTML=e.responseText;var c=$("co-shipping-method-form");var d=c.getInputs("radio");var b=false;d.each(function(g,f){if(g.checked){b=true}});if(j2t_address_completion!=1&&!b&&d.length>0){d[0].checked=true}j2t_one_checkout.stepShippingComplete=true;j2t_one_checkout.stepProcess++;j2t_one_checkout.reloadPayment();if(typeof j2t_onecheckout_reload!=="undefined"){j2t_onecheckout_reload()}}})}},reloadProcess:function(){}};var J2t_Billing=Class.create();J2t_Billing.prototype={initialize:function(f,b,e,d,c,a){this.form=f;if($(this.form)){$(this.form).observe("submit",function(g){Event.stop(g)}.bind(this))}this.addressUrl=b;this.saveUrl=e;this.shippingUrl=d;this.paymentUrl=c;this.reviewUrl=a;this.onSave=this.preNextStep.bindAsEventListener(this)},newAddress:function(a){if(a){this.resetSelectedAddress();Element.show("billing-new-address-form")}else{Element.hide("billing-new-address-form")}},resetSelectedAddress:function(){var a=$("billing-address-select");if(a){a.value=""}},preNextStep:function(transport){if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}}if(response.error){if((typeof response.message)=="string"){alert(response.message)}else{if(window.billingRegionUpdater){billingRegionUpdater.update()}alert(response.message.join("\n"))}return false}else{this.nextStep.bind(this)}},nextStep:function(parent){if(parent&&parent.responseText){try{response=eval("("+parent.responseText+")")}catch(e){response={}}}if(response.error){j2t_one_checkout.stepShippingMethodOk=true;j2t_one_checkout.stepPaymentMethodOk=true;j2t_one_checkout.stepOrderReviewOk=true;j2t_one_checkout.hideLoading();if((typeof response.message)=="string"){alert(response.message)}return false}else{if(j2t_one_checkout.doSaveShipping){if(j2t_one_checkout.saveRealShipping&&j2t_one_checkout.stepSoColissimo){redirectToColissimo()}if(!$("billing:use_for_shipping_no")&&!$("billing:use_for_shipping_yes")){shippingMethod.save()}else{if($("billing:use_for_shipping_yes").checked){shippingMethod.save()}else{shipping.save()}}j2t_one_checkout.doSaveShipping=false}else{j2t_one_checkout.refreshShippingMethodRadio()}}},checkSave:function(){var a="";var c="";var d="";if($("billing:use_for_shipping_yes").checked){a=$F("billing:country_id");c=$F("billing:postcode");if($("billing:region_id")){d=$F("billing:region_id")}}else{a=$F("shipping:country_id");c=$F("shipping:postcode");if($("shipping:region_id")){d=$F("shipping:region_id")}}if(j2t_one_checkout.shippingQuoteCountry!=a||j2t_one_checkout.shippingQuoteRegion!=d||j2t_one_checkout.shippingQuotePostCode!=c){j2t_one_checkout.submitShippingQuote();j2t_one_checkout.shippingQuoteCountry=a;j2t_one_checkout.shippingQuoteRegion=d;j2t_one_checkout.shippingQuotePostCode=c}var b=true},validateSilent:function(){if($("billing:use_for_shipping_yes").checked){var a=new Validation(this.form,{stopOnFirst:false,focusOnError:false});if(!a.validate()){a.reset();return false}else{return true}}else{return shipping.validateSilent()}},save:function(){var a=new Validation(this.form);if(a.validate()){var b=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",onSuccess:this.nextStep.bind(this),parameters:Form.serialize(this.form)})}}};var J2t_Shipping=Class.create();J2t_Shipping.prototype={initialize:function(e,b,d,f,c,a){this.form=e;if($(this.form)){$(this.form).observe("submit",function(g){Event.stop(g)}.bind(this))}this.addressUrl=b;this.saveUrl=d;this.methodsUrl=f;this.paymentUrl=c;this.reviewUrl=a},newAddress:function(a){if(a){this.resetSelectedAddress();Element.show("shipping-new-address-form")}else{Element.hide("shipping-new-address-form")}shipping.setSameAsBilling(false)},resetSelectedAddress:function(){var a=$("shipping-address-select");if(a){a.value=""}},setSameAsBilling:function(a){$("shipping:same_as_billing").checked=a;if(a){this.syncWithBilling()}},syncWithBilling:function(){$("billing-address-select")&&this.newAddress(!$("billing-address-select").value);$("shipping:same_as_billing").checked=true;if(!$("billing-address-select")||!$("billing-address-select").value){arrElements=Form.getElements(this.form);for(var a in arrElements){if(arrElements[a].id){var b=$(arrElements[a].id.replace(/^shipping:/,"billing:"));if(b){arrElements[a].value=b.value}}}shippingRegionUpdater.update();if($("shipping:region_id")){$("shipping:region_id").value=$("billing:region_id").value}$("shipping:region").value=$("billing:region").value}else{$("shipping-address-select").value=$("billing-address-select").value}},nextStep:function(a){if(j2t_one_checkout.doSaveShippingMethod){shippingMethod.save();j2t_one_checkout.doSaveShippingMethod=false}else{if(j2t_one_checkout.userLoggedAddress){j2t_one_checkout.refreshPaymentMethodInputs();j2t_one_checkout.refreshShippingMethodRadio()}else{j2t_one_checkout.reloadShippingSave()}}},checkSaveReloadShippingMethod:function(){var a=new Validation(this.form,{stopOnFirst:true,focusOnError:false});if(!a.validate()){a.reset()}else{if($("billing:use_for_shipping_no")&&$("billing:use_for_shipping_yes")){if($("billing:use_for_shipping_no").checked){this.save()}else{if($("billing:use_for_shipping_yes").checked){this.save()}}}else{if(!$("billing:use_for_shipping_no")&&!$("billing:use_for_shipping_yes")){this.save()}}}},validateSilent:function(){var a=new Validation(this.form,{stopOnFirst:false,focusOnError:false});if(!a.validate()){a.reset();return false}else{if($("billing:use_for_shipping_no")&&$("billing:use_for_shipping_yes")){if($("billing:use_for_shipping_no").checked){return true}else{if($("billing:use_for_shipping_yes").checked){return true}}}else{return true}}},checkSave:function(){var a=new Validation(this.form,{stopOnFirst:true,focusOnError:false});if(!a.validate()){a.reset()}else{if($("billing:use_for_shipping_no")&&$("billing:use_for_shipping_yes")){if($("billing:use_for_shipping_no").checked){this.save()}else{if($("billing:use_for_shipping_yes").checked){this.save()}}}}},nextStepSave:function(a){},save:function(){var a=new Validation(this.form);if(a.validate()){var b=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",onSuccess:this.nextStep.bind(this),parameters:Form.serialize(this.form)})}}};var J2t_ShippingMethod=Class.create();J2t_ShippingMethod.prototype={initialize:function(e,d,c,b,a,f){this.form=e;if($(this.form)){$(this.form).observe("submit",function(g){Event.stop(g)}.bind(this))}this.saveUrl=d;this.validator=new Validation(this.form);this.shippingUrl=c;this.paymentUrl=b;this.reviewUrl=a;this.isVirtual=f},validate:function(){if(this.isVirtual){return true}var a=document.getElementsByName("shipping_method");if(a.length==0){alert(Translator.translate("Your order cannot be completed at this time as there is no shipping methods available for it. Please make neccessary changes in your shipping address."));return false}if(!this.validator.validate()){return false}for(var b=0;b<a.length;b++){if(a[b].checked){return true}}for(var b=0;b<a.length;b++){a[b].checked=true;return true}alert(Translator.translate("Please specify shipping method."));return false},nextStep:function(a){if(j2t_one_checkout.doSavePaymentMethod){payment.save();j2t_one_checkout.doSavePaymentMethod=false}else{j2t_one_checkout.stepShippingComplete=true;if((j2t_one_checkout.reloadShippingOnBilling&&j2t_one_checkout.saveShippingOnBilling)){j2t_one_checkout.reloadPayment()}if(j2t_one_checkout.reloadReviewOnShippingSave){j2t_one_checkout.stepShippingMethodOk=true;j2t_one_checkout.stepPaymentMethodOk=true;j2t_one_checkout.reloadReview();j2t_one_checkout.reloadReviewOnShippingSave=false}}if(j2t_one_checkout.reloadPaymentMethodOnShipping){j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.refreshPaymentSave()}},nextStepRefresh:function(a){j2t_one_checkout.reloadReview();j2t_one_checkout.stepShippingComplete=true;j2t_one_checkout.refreshShippingMethodRadio();if(j2t_one_checkout.reloadPaymentMethodOnShipping){j2t_one_checkout.stepPaymentMethodOk=false;j2t_one_checkout.refreshPaymentSave()}},saveRefresh:function(){if(this.validate()){var a=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",onSuccess:this.nextStepRefresh.bind(this),parameters:Form.serialize(this.form)})}else{j2t_one_checkout.hideLoading()}},save:function(){if(this.validate()){var b=Form.serialize(this.form);j2t_one_checkout.showLoading();var a=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",onSuccess:this.nextStep.bind(this),parameters:b});j2t_one_checkout.completeOff()}}};var J2t_Payment=Class.create();J2t_Payment.prototype={beforeInitFunc:$H({}),afterInitFunc:$H({}),beforeValidateFunc:$H({}),afterValidateFunc:$H({}),initialize:function(e,d,c,b,a){this.form=e;this.saveUrl=d;this.shippingUrl=c;this.paymentUrl=b;this.reviewUrl=a},beforeInit:function(){(this.beforeInitFunc).each(function(a){(a.value)()})},init:function(){this.beforeInit();var b=Form.getElements(this.form);if($(this.form)){$(this.form).observe("submit",function(d){Event.stop(d)}.bind(this))}var c=null;for(var a=0;a<b.length;a++){if(b[a].name=="payment[method]"){if(b[a].checked){c=b[a].value}}else{}b[a].setAttribute("autocomplete","off")}if(c){this.switchMethod(c)}this.afterInit()},addAfterInitFunction:function(b,a){this.afterInitFunc.set(b,a)},afterInit:function(){(this.afterInitFunc).each(function(a){(a.value)()})},checkSave:function(){var a=new Validation(this.form,{stopOnFirst:true,focusOnError:false});if(!a.validate()){a.reset()}else{this.save()}},switchMethod:function(e){if(this.currentMethod&&$("payment_form_"+this.currentMethod)){var b=$("payment_form_"+this.currentMethod);b.style.display="none";var d=b.select("input","select","textarea")}if($("payment_form_"+e)){var b=$("payment_form_"+e);b.style.display="";var d=b.select("input","select","textarea")}else{document.body.fire("payment-method:switched",{method_code:e})}this.currentMethod=e;var c=$("co-payment-form");var a=c.getInputs("text","password")},addBeforeValidateFunction:function(b,a){this.beforeValidateFunc.set(b,a)},beforeValidate:function(){j2t_one_checkout.refreshPaymentMethodInputs();var b=true;var a=false;(this.beforeValidateFunc).each(function(c){a=true;if((c.value)()==false){b=false}}.bind(this));if(!a){b=false}return b},nextStep:function(parent){if(j2t_one_checkout.checkRedirect){if(parent&&parent.responseText){try{response=eval("("+parent.responseText+")");if(response.redirect){location.href=response.redirect;return true}}catch(e){response={}}}}if(j2t_one_checkout.doSubmitOrder){j2t_one_checkout.reloadReview();j2t_one_checkout.doSubmitOrder=false}else{if(j2t_one_checkout.needPaymentRefresh){j2t_one_checkout.needPaymentRefresh=false}j2t_one_checkout.reloadReview();j2t_one_checkout.stepPaymentComplete=true}},saveNocheck:function(){j2t_one_checkout.showLoading();$$("#co-payment-form input").invoke("enable");$$("#co-payment-form radio").invoke("enable");$$("#co-payment-form select").invoke("enable");var a=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",onSuccess:function(){j2t_one_checkout.stepShippingMethodOk=true;j2t_one_checkout.stepPaymentMethodOk=true;j2t_one_checkout.reloadReview()},parameters:Form.serialize(this.form)})},save:function(){var a=new Validation(this.form);$$("#co-payment-form input").invoke("enable");$$("#co-payment-form radio").invoke("enable");$$("#co-payment-form select").invoke("enable");if(this.validate()&&a.validate()){var b=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",onSuccess:this.nextStep.bind(this),parameters:Form.serialize(this.form)});j2t_one_checkout.showLoading()}else{j2t_one_checkout.hideLoading()}},afterValidate:function(){var b=true;var a=false;(this.afterValidateFunc).each(function(c){a=true;if((c.value)()==false){b=false}}.bind(this));if(!a){b=false}return b},validate:function(){var a=this.beforeValidate();if(a){return true}var b=document.getElementsByName("payment[method]");if(b.length==0){alert(Translator.translate("Your order cannot be completed at this time as there is no payment methods available for it."));return false}for(var c=0;c<b.length;c++){if(b[c].checked){return true}}a=this.afterValidate();if(a){return true}alert(Translator.translate("Please specify payment method."));return false}};var J2t_Review=Class.create();J2t_Review.prototype={initialize:function(c,b,a){this.saveUrl=c;this.successUrl=b;this.agreementsForm=a;this.onSave=this.nextStep.bindAsEventListener(this)},save:function(){var c=true;var d=new Validation(shipping.form,{stopOnFirst:false,focusOnError:false});if(!d.validate()){d.reset();c=false}var e=new Validation(billing.form,{stopOnFirst:false,focusOnError:false});if(!e.validate()){e.reset();c=false}var b=new Validation(shippingMethod.form,{stopOnFirst:false,focusOnError:false});if(!b.validate()){b.reset();c=false}var a=new Validation(payment.form,{stopOnFirst:false,focusOnError:false});if(!a.validate()){a.reset();c=false}if(c){j2t_one_checkout.showLoading();j2t_one_checkout.checkRedirect=true;j2t_one_checkout.saveAndSubmitAll()}else{alert(Translator.translate("Please review the checkout forms."))}},saveGoReview:function(){j2t_one_checkout.setLoadWaiting("review");var b=Form.serialize(payment.form);if(this.agreementsForm){b+="&"+Form.serialize(this.agreementsForm)}b.save=true;var a=new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",parameters:b,onComplete:function(c){j2t_one_checkout.hideLoading()},onSuccess:this.onSave});j2t_one_checkout.stepShippingMethodOk=true;j2t_one_checkout.stepPaymentMethodOk=true;j2t_one_checkout.stepOrderReviewOk=true;j2t_one_checkout.hideLoading()},nextStep:function(transport){j2t_one_checkout.hideLoading();if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.redirect){location.href=response.redirect;return}if(response.success){this.isSuccess=true;window.location=this.successUrl}else{if(response.update_section){if(!$("checkout-"+response.update_section.name+"-load")){$$(".j2t-onecheckout-left-4")[0].insert({bottom:new Element("div",{id:"checkout-"+response.update_section.name+"-load"})});$("checkout-"+response.update_section.name+"-load").className="authentication"}var element_tobe_inserted=response.update_section.html;element_tobe_inserted=element_tobe_inserted.replace("checkout.accordion.container.readAttribute('id')","''");element_tobe_inserted=element_tobe_inserted.replace("checkout.loadWaiting","var void_element");element_tobe_inserted=element_tobe_inserted.replace("checkout.setLoadWaiting(false);","");element_tobe_inserted=element_tobe_inserted.replace("checkout.setLoadWaiting(true);","");element_tobe_inserted=element_tobe_inserted.replace("checkout.accordion.currentSection","'opc-'+void_element");$("checkout-"+response.update_section.name+"-load").update(element_tobe_inserted);element_tobe_inserted.evalScripts()}else{var msg=response.error_messages;if(typeof(msg)=="object"){msg=msg.join("\n")}$("review-please-wait").hide();alert(msg)}}if(response.update_section){}if(response.goto_section){}}}};